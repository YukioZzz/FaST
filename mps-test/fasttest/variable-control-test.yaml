apiVersion: faasshare.tum/v1
kind: SharePod
metadata:
  name: rnnt
  namespace: faas-share-fn
  labels:
    "com.openfaas.scale.max": "1"
  annotations:
    "kubeshare/gpu_request": "0.5"
    "kubeshare/gpu_limit": "0.5"
    "kubeshare/gpu_partition": "24"
    "kubeshare/gpu_mem": "1073741824"
spec:
  replicas: 1
  podSpec:
    terminationGracePeriodSeconds: 1
    containers:
      - name: rnnt
        image: yukiozhu/mlperf-faas-rnnt 
        env:
          - name: CUDA_MPS_ACTIVE_THREAD_PERCENTAGE
            value: "24"
        ports:
          - containerPort: 8080
        readinessProbe:
          tcpSocket:
            port: 5000
          initialDelaySeconds: 5
          periodSeconds: 10
        volumeMounts:
          - name: "model-volume"
            mountPath: "/models/"
    volumes:
      - name: "model-volume"
        hostPath:
          path: "/models/"

---
apiVersion: faasshare.tum/v1
kind: SharePod
metadata:
  name: resnet
  namespace: faas-share-fn
  labels:
    "com.openfaas.scale.max": "1"
    "com.openfaas.scale.min": "1"
  annotations:
    "kubeshare/gpu_request": "0.5"
    "kubeshare/gpu_limit": "0.8"
    "kubeshare/gpu_partition": "24"
    "kubeshare/gpu_mem": "1073741824"
spec:
  replicas: 1
  podSpec:
    terminationGracePeriodSeconds: 1
    containers:
      - name: resnet
        image: yukiozhu/mlperf-faas-resnet:pytorch
        env:
          - name: CUDA_MPS_ACTIVE_THREAD_PERCENTAGE
            value: "24"
        ports:
          - containerPort: 8080
        readinessProbe:
          tcpSocket:
            port: 5000
          initialDelaySeconds: 5
          periodSeconds: 10
        volumeMounts:
          - name: "model-volume"
            mountPath: "/models/"
    volumes:
      - name: "model-volume"
        hostPath:
          path: "/models/"
